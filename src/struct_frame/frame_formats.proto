// Frame Format Definitions for struct-frame
// Defines message framing formats for communication over serial, network, or byte streams.
//
// FRAMING ARCHITECTURE:
// The framing system has two levels:
// 1. HEADER (Framing Level): Determines start bytes for synchronization
//    - Basic: 2 start bytes [0x90] [0x70+payload_type]
//    - Tiny:  1 start byte [0x70+payload_type]
//    - None:  0 start bytes (relies on external sync)
//    - MavlinkV1: 1 start byte [0xFE]
//    - MavlinkV2: 1 start byte [0xFD]
//    - UBX: 2 start bytes [0xB5] [0x62]
//
// 2. PAYLOAD TYPE: Defines the header/footer structure of the payload
//    The second start byte of Basic (or the single start byte of Tiny) encodes the payload type.
//
// Frame = Header + Payload
// Payload = PayloadHeader + Message + PayloadFooter

package frame_formats;

// ============================================================================
// HEADER TYPE ENUMERATION
// ============================================================================
// HeaderType defines the framing level (start byte pattern)

enum HeaderType {
  // None: No start bytes, relies on external synchronization
  HEADER_NONE = 0;

  // Tiny: 1 start byte [0x70+PayloadType]
  HEADER_TINY = 1;

  // Basic: 2 start bytes [0x90] [0x70+PayloadType]
  HEADER_BASIC = 2;

  // UBX: 2 start bytes [0xB5] [0x62]
  HEADER_UBX = 3;

  // MavlinkV1: 1 start byte [0xFE]
  HEADER_MAVLINK_V1 = 4;

  // MavlinkV2: 1 start byte [0xFD]
  HEADER_MAVLINK_V2 = 5;
}

// ============================================================================
// PAYLOAD TYPE ENUMERATION
// ============================================================================
// PayloadType defines how the payload is structured (header fields + CRC)
// For Basic/Tiny: start byte encodes this as 0x70 + PayloadType value

enum PayloadType {
  // Minimal: [MSG_ID] [PACKET]
  // No length field, no CRC. Requires known message sizes.
  PAYLOAD_MINIMAL = 0;

  // Default: [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // 1-byte length, 2-byte CRC. Standard format.
  PAYLOAD_DEFAULT = 1;

  // ExtendedMsgIds: [LEN] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Adds package ID for message namespace separation.
  PAYLOAD_EXTENDED_MSG_IDS = 2;

  // ExtendedLength: [LEN16] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // 2-byte length for payloads up to 65535 bytes.
  PAYLOAD_EXTENDED_LENGTH = 3;

  // Extended: [LEN16] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Extended message IDs + 2-byte length.
  PAYLOAD_EXTENDED = 4;

  // SysComp: [SYS_ID] [COMP_ID] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Adds system and component IDs for multi-system networks.
  PAYLOAD_SYS_COMP = 5;

  // Seq: [SEQ] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Adds sequence number for packet loss detection.
  PAYLOAD_SEQ = 6;

  // MultiSystemStream: [SEQ] [SYS_ID] [COMP_ID] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Combines Seq + SysComp for multi-system streaming.
  PAYLOAD_MULTI_SYSTEM_STREAM = 7;

  // ExtendedMultiSystemStream: [SEQ] [SYS_ID] [COMP_ID] [LEN16] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
  // Full featured format with all extensions.
  PAYLOAD_EXTENDED_MULTI_SYSTEM_STREAM = 8;
}

// ============================================================================
// HEADER DEFINITIONS
// ============================================================================
// Each header type defines its start byte pattern

// None Header - No start bytes
message HeaderNone {
  // No fields - relies on external synchronization
}

// Tiny Header - 1 start byte encoding payload type
// Start byte = 0x70 + PayloadType
message HeaderTiny {
  uint8 start_byte = 1;  // 0x70 + PayloadType (0x70-0x78)
}

// Basic Header - 2 start bytes
// Start byte 1 = 0x90 (fixed)
// Start byte 2 = 0x70 + PayloadType
message HeaderBasic {
  uint8 start_byte1 = 1 [(hex) = 0x90];
  uint8 start_byte2 = 2;  // 0x70 + PayloadType (0x70-0x78)
}

// UBX Header - u-blox GPS/GNSS protocol
message HeaderUbx {
  uint8 sync1 = 1 [(hex) = 0xB5];
  uint8 sync2 = 2 [(hex) = 0x62];
}

// MavlinkV1 Header
message HeaderMavlinkV1 {
  uint8 stx = 1 [(hex) = 0xFE];
}

// MavlinkV2 Header
message HeaderMavlinkV2 {
  uint8 stx = 1 [(hex) = 0xFD];
}

// ============================================================================
// PAYLOAD DEFINITIONS
// ============================================================================
// Each payload type defines its structure (fields before and after message)

// Minimal Payload: [MSG_ID] [PACKET]
// No length field, no CRC. Requires known message sizes.
// Overhead: 1 byte
message PayloadMinimal {
  uint8 msg_id = 1;
  // [PACKET] - message data
}

// Default Payload: [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
// 1-byte length, 2-byte CRC. Standard format.
// Overhead: 4 bytes
message PayloadDefault {
  uint8 length = 1;
  uint8 msg_id = 2;
  // [PACKET] - message data
  uint8 crc_byte1 = 3;
  uint8 crc_byte2 = 4;
}

// ExtendedMsgIds Payload: [LEN] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Adds package ID for message namespace separation.
// Overhead: 5 bytes
message PayloadExtendedMsgIds {
  uint8 length = 1;
  uint8 package_id = 2;
  uint8 msg_id = 3;
  // [PACKET] - message data
  uint8 crc_byte1 = 4;
  uint8 crc_byte2 = 5;
}

// ExtendedLength Payload: [LEN16] [MSG_ID] [PACKET] [CRC1] [CRC2]
// 2-byte length for payloads up to 65535 bytes.
// Overhead: 5 bytes
message PayloadExtendedLength {
  uint16 length = 1;
  uint8 msg_id = 2;
  // [PACKET] - message data
  uint8 crc_byte1 = 3;
  uint8 crc_byte2 = 4;
}

// Extended Payload: [LEN16] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Extended message IDs + 2-byte length.
// Overhead: 6 bytes
message PayloadExtended {
  uint16 length = 1;
  uint8 package_id = 2;
  uint8 msg_id = 3;
  // [PACKET] - message data
  uint8 crc_byte1 = 4;
  uint8 crc_byte2 = 5;
}

// SysComp Payload: [SYS_ID] [COMP_ID] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Adds system and component IDs for multi-system networks.
// Overhead: 6 bytes
message PayloadSysComp {
  uint8 system_id = 1;
  uint8 component_id = 2;
  uint8 length = 3;
  uint8 msg_id = 4;
  // [PACKET] - message data
  uint8 crc_byte1 = 5;
  uint8 crc_byte2 = 6;
}

// Seq Payload: [SEQ] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Adds sequence number for packet loss detection.
// Overhead: 5 bytes
message PayloadSeq {
  uint8 sequence = 1;
  uint8 length = 2;
  uint8 msg_id = 3;
  // [PACKET] - message data
  uint8 crc_byte1 = 4;
  uint8 crc_byte2 = 5;
}

// MultiSystemStream Payload: [SEQ] [SYS_ID] [COMP_ID] [LEN] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Combines Seq + SysComp for multi-system streaming.
// Overhead: 7 bytes
message PayloadMultiSystemStream {
  uint8 sequence = 1;
  uint8 system_id = 2;
  uint8 component_id = 3;
  uint8 length = 4;
  uint8 msg_id = 5;
  // [PACKET] - message data
  uint8 crc_byte1 = 6;
  uint8 crc_byte2 = 7;
}

// ExtendedMultiSystemStream Payload: [SEQ] [SYS_ID] [COMP_ID] [LEN16] [PKG_ID] [MSG_ID] [PACKET] [CRC1] [CRC2]
// Full featured format with all extensions.
// Overhead: 9 bytes
message PayloadExtendedMultiSystemStream {
  uint8 sequence = 1;
  uint8 system_id = 2;
  uint8 component_id = 3;
  uint16 length = 4;
  uint8 package_id = 5;
  uint8 msg_id = 6;
  // [PACKET] - message data
  uint8 crc_byte1 = 7;
  uint8 crc_byte2 = 8;
}

// ============================================================================
// THIRD PARTY PROTOCOL PAYLOADS
// ============================================================================

// UBX Payload - u-blox GPS/GNSS protocol
// Format: [CLASS] [ID] [LEN_LO] [LEN_HI] [MSG] [CK_A] [CK_B]
// Overhead: 6 bytes (after header)
message PayloadUbx {
  uint8 msg_class = 1;
  uint8 msg_id = 2;
  uint8 length_lo = 3;
  uint8 length_hi = 4;
  // [MSG] - message data
  uint8 crc_byte1 = 7;
  uint8 crc_byte2 = 8;
}

// MAVLINK V1 Payload
// Format: [LEN] [SEQ] [SYS] [COMP] [MSG_ID] [PAYLOAD] [CRC_LO] [CRC_HI]
// Overhead: 7 bytes (after header)
message PayloadMavlinkV1 {
  uint8 length = 1;
  uint8 sequence = 2;
  uint8 system_id = 3;
  uint8 component_id = 4;
  uint8 msg_id = 5;
  // [PAYLOAD] - message data
  uint8 crc_byte1 = 7;
  uint8 crc_byte2 = 8;
}

// MAVLINK V2 Payload
// Format: [LEN] [INCOMPAT] [COMPAT] [SEQ] [SYS] [COMP] [MSG_ID x3] [PAYLOAD] [CRC] [SIG?]
// Overhead: 11 bytes (after header), +13 if signed
message PayloadMavlinkV2 {
  uint8 length = 1;
  uint8 incompat_flags = 2;
  uint8 compat_flags = 3;
  uint8 sequence = 4;
  uint8 system_id = 5;
  uint8 component_id = 6;
  uint8 msg_id_0 = 7;
  uint8 msg_id_1 = 8;
  uint8 msg_id_2 = 9;
  // [PAYLOAD] - message data
  uint8 crc_byte1 = 7;
  uint8 crc_byte2 = 8;
}


// ============================================================================
// RUNTIME CONFIGURATION
// ============================================================================

// Runtime frame format configuration
// Combines a header type with a payload type
message FrameFormatConfig {
  HeaderType header_type = 1;
  PayloadType payload_type = 2;
  bool crc_enabled = 3;
}
